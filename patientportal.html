<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css" />
    <link href="https://fonts.googleapis.com/css?family=Sen:400,700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>
    <title>Covid-19 Challenge</title>
</head>

<body>
    <div class="information-box">
        <h1 class="information-header">My actions</h1>
        <a id="information-expand">Click to expand</a>
        <ul class="information-bullets">
            <li><a id="editLink" class="information-link">Edit personal information</a></li>
            <li><a id="apptLink" class="information-link">Check for appointments</a></li>
            <li><a id="resLink" class="information-link">View test results</a>
            </li>
        </ul>

        <p class="information-paragraph">You can use this page to update your personal information (including updating
            your symptoms and information you may have filled out incorrectly).</p>

        <p class="information-paragraph">Click on the links above to edit your personal information, see if an
            appointment has been scheduled for you, and view test results (if they have been processed).</p>

    </div>

    <div class="action-box">
        <div id="personal-information-box">
            <h1 class="portal-header">Edit personal information</h1>
            <table id="registration-table">
                <tr>
                    <td class='patient-table-left'>First name</td>
                    <td>
                        <input id="firstName" type="text" class="patient-input" placeholder="John"></input>
                    </td>
                </tr>
                <tr>
                    <td class='patient-table-left'>Last name</td>
                    <td>
                        <input id="lastName" type="text" class="patient-input" placeholder="Doe"> </input>
                    </td>
                </tr>
                <tr>
                    <td class='patient-table-left'>Email address</td>
                    <td>
                        <input id="emailAddress" class="patient-input" type="email"
                            placeholder="person@example.com"></input>
                    </td>
                </tr>
                <tr>
                    <td class='patient-table-left'>Date of birth</td>
                    <td>
                        <input id="dateOfBirth" class="patient-input" type="date" placeholder="03/31/1993"
                            pattern="[0-9]{2}/[0-9]{2}/[0-9]{4}" onchange="checkAge(this.value)" required></input>
                    </td>
                </tr>
                <tr>
                    <td class='patient-table-left'>Phone number</td>
                    <td>
                        <input id="phoneNumber" class="patient-input" type="tel" placeholder="(012) 345-6789"
                            pattern="([0-9]{3}) [0-9]{3}-[0-9]{4}" required></input>
                    </td>
                </tr>

                <tr>
                    <td class='patient-table-left'>Home address</td>
                    <td>
                        <input id="homeAddress1" class="patient-input-address" type="text"
                            placeholder="1 Neverending Road"></input>
                        <input id="homeAddress2" class="patient-input-address" type="text"
                            placeholder="Lancaster, PA 17601"></input>
                    </td>
                </tr>

                <tr>
                    <td class='patient-table-left'>Sex</td>
                    <td>
                        <label>
                            <input class="patient-input" type="radio" name="sex" value="Male"></input> Male
                        </label>
                        <label>
                            <input class="patient-input" type="radio" name="sex" value="Female"></input> Female
                        </label>
                        <label>
                            <input class="patient-input" type="radio" name="sex" value="Other"></input> Other
                        </label>

                    </td>
                </tr>

                <tr class="parent-info">
                    <td class='patient-table-left'>Primary guardian's first name</td>
                    <td>
                        <input id="guardianFirstName" class="patient-input" placeholder="John"></input>
                    </td>
                </tr>
                <tr class="parent-info">
                    <td class='patient-table-left'>Primary guardian's last name</td>
                    <td>
                        <input id="guardianLastName" class="patient-input" placeholder="Doe"> </input>
                    </td>
                </tr>
                <tr class="parent-info">
                    <td class='patient-table-left'>Primary guardian's email address</td>
                    <td>
                        <input id="guardianEmailAddress" class="patient-input" type="email"
                            placeholder="person@example.com"></input>
                    </td>
                </tr>
                <tr class="parent-info">
                    <td class='patient-table-left'>Primary guardian's phone number</td>
                    <td>
                        <input id="guardianPhoneNumber" class="patient-input" type="tel" placeholder="(012) 345-6789"
                            pattern="([0-9]{3}) [0-9]{3}-[0-9]{4}" required></input>
                    </td>
                </tr>

                <tr class="parent-info">
                    <td class='patient-table-left'>Primary guardian's home address</td>
                    <td>
                        <input id="guardianAddressLine1" class="patient-input-address" type="text"
                            placeholder="1 Neverending Road"></input>
                        <input id="guardianAddressLine2" class="patient-input-address" type="text"
                            placeholder="Lancaster, PA 17601"></input>
                    </td>
                </tr>

                <tr>
                    <td class='patient-table-left'>Ethnicity</td>
                    <td>
                        <label>
                            <input class="patient-input" type="radio" name="ethnicity" value="Hispanic/Latino"></input>
                            Hispanic/Latino
                        </label>
                        <label>
                            <input class="patient-input" type="radio" name="ethnicity"
                                value="Non Hispanic/Latino"></input>
                            Non Hispanic/Latino
                        </label>
                        <label>
                            <input class="patient-input" type="radio" name="ethnicity" value="Not specified"></input>
                            Not specified
                        </label>

                    </td>
                </tr>

                <tr>
                    <td class='patient-table-left'>Race (check all that apply)</td>
                    <td>
                        <label>
                            <input class="patient-input" type="checkbox" name="race" value="Asian"></input> Asian
                        </label>
                        <label>
                            <input class="patient-input" type="checkbox" name="race" value="Black"></input> Black
                        </label>
                        <label>
                            <input class="patient-input" type="checkbox" name="race" value="White"></input> White
                        </label>
                        <label>
                            <input class="patient-input" type="checkbox" name="race"
                                value="American Indian/Alaska Native"></input>
                            American Indian/Alaska Native
                        </label>
                        <label>
                            <input class="patient-input" type="checkbox" name="race"
                                value="Native Hawaiian/Other Pacific Islander"></input> Native Hawaiian/Other Pacific
                            Islander
                        </label>
                        <label>
                            <input class="patient-input" type="checkbox" name="race" value="Unknown"></input> Unknown
                        </label>
                        Other: <input id="other-race" class="patient-input" type="text" placeholder="..."></input>
                    </td>
                </tr>

                <tr>
                    <td class='patient-table-left'>Are you a healthcare worker in the United States?</td>
                    <td>
                        <label>
                            <input class="patient-input" type="radio" name="worker" value="Yes"></input> Yes
                        </label>
                        <label>
                            <input class="patient-input" type="radio" name="worker" value="No"></input> No
                        </label>
                    </td>
                </tr>

                <tr>
                    <td class='patient-table-left'>Do you have a history of being in a healthcare facility (as a
                        patient,
                        worker or visitor) in China?</td>
                    <td>
                        <label>
                            <input class="patient-input" type="radio" name="china" value="Yes"></input> Yes
                        </label>
                        <label>
                            <input class="patient-input" type="radio" name="china" value="No"></input> No
                        </label>
                    </td>
                </tr>

                <tr>
                    <td class='patient-table-left'>If symptomatic, symptom onset date</td>
                    <td><input id="onsetDate" class="patient-input" type="date" placeholder="03/20/2020"
                            pattern="[0-9]{2}/[0-9]{2}/[0-9]{4}" required></input></td>
                </tr>

                <tr>
                    <td class='patient-table-left'>If symptomatic, date of symptom resolution</td>
                    <td><input id="resolutionDate" class="patient-input" type="date" placeholder="03/20/2020"
                            pattern="[0-9]{2}/[0-9]{2}/[0-9]{4}" required></input></td>
                </tr>

                <tr>
                    <td class='patient-table-left'>Symptoms</td>
                    <td>
                        <label>
                            <input class="patient-input" type="checkbox" name="symptoms" value="Fever > 100.4F"></input>
                            Fever > 100.4F
                        </label>
                        <label>
                            <input class="patient-input" type="checkbox" name="symptoms"
                                value="Subjective fever (felt feverish)"></input> Subjective fever (felt feverish)
                        </label>
                        <label>
                            <input class="patient-input" type="checkbox" name="symptoms" value="Chills"></input> Chills
                        </label>
                        <label>
                            <input class="patient-input" type="checkbox" name="symptoms"
                                value="Muscle aches (myalgia)"></input> Muscle
                            aches (myalgia)
                        </label>
                        <label>
                            <input class="patient-input" type="checkbox" name="symptoms"
                                value="Runny nose (rhinorrhea)"></input> Runny nose
                            (rhinorrhea)
                        </label>
                        <label>
                            <input class="patient-input" type="checkbox" name="symptoms" value="Sore throat"></input>
                            Sore
                            throat
                        </label>
                        <label>
                            <input class="patient-input" type="checkbox" name="symptoms"
                                value="Cough (new or worsening chronic cough)"></input> Cough (new or worsening chronic
                            cough)
                        </label>
                        <label>
                            <input class="patient-input" type="checkbox" name="symptoms"
                                value="Shortness of breath (dyspnea)"></input> Shortness of breath (dyspnea)
                        </label>
                        <label>
                            <input class="patient-input" type="checkbox" name="symptoms"
                                value="Nausea or vomiting"></input>
                            Nausea or
                            vomiting
                        </label>
                        <label>
                            <input class="patient-input" type="checkbox" name="symptoms" value="Headache"></input>
                            Headache
                        </label>
                        <label>
                            <input class="patient-input" type="checkbox" name="symptoms" value="Abdominal pain"></input>
                            Abdominal pain
                        </label>
                        <label>
                            <input class="patient-input" type="checkbox" name="symptoms"
                                value="Diarrhea (≥3 loose/looser than normal stools/24hr period)"></input> Diarrhea (≥3
                            loose/looser than
                            normal stools/24hr period)
                        </label>
                        Other: <input id="other-symptom" class="patient-input" type="text" placeholder="..."></input>
                    </td>
                </tr>

                <tr>
                    <td class='patient-table-left'>Pre-existing conditions</td>
                    <td>
                        <label>
                            <input class="patient-input" type="checkbox"
                                value="Chronic Lung Disease (asthma/emphysema/COPD)" name="existing"></input> Chronic
                            Lung
                            Disease
                            (asthma/emphysema/COPD)
                        </label>
                        <label>
                            <input class="patient-input" type="checkbox" name="existing"
                                value="Diabetes Mellitus"></input>
                            Diabetes
                            Mellitus
                        </label>
                        <label>
                            <input class="patient-input" type="checkbox" name="existing"
                                value="Cardiovascular disease"></input>
                            Cardiovascular disease
                        </label>
                        <label>
                            <input class="patient-input" type="checkbox" name="existing"
                                value="Chronic Renal diseases"></input> Chronic
                            Renal diseases
                        </label>
                        <label>
                            <input class="patient-input" type="checkbox" name="existing"
                                value="Chronic Liver disease"></input> Chronic
                            Liver disease
                        </label>
                        <label>
                            <input class="patient-input" type="checkbox" name="existing"
                                value="Immunocompromised Condition"></input>
                            Immunocompromised Condition
                        </label>
                        <label>
                            <input class="patient-input" type="checkbox" name="existing"
                                value="Neurologic, neurodevelopmental, and/or intellectual disability"></input>
                            Neurologic, neurodevelopmental, and/or intellectual disability
                            (Please specify: <input id="other-disability" class="patient-input" type="text"
                                placeholder="..."></input>)
                        </label>
                        <label>
                            <input class="patient-input" type="checkbox" name="existing"
                                value="Other chronic diseases"></input>
                            Other chronic diseases (Please specify: <input id="other-chronic" class="patient-input"
                                type="text" placeholder="..."></input>)
                        </label>
                        <label>
                            <input class="patient-input" type="checkbox" name="existing"
                                value="If female, currently pregnant"></input> If
                            female, currently pregnant
                        </label>
                        <label>
                            <input class="patient-input" type="checkbox" name="existing" value="Current smoker"></input>
                            Current smoker
                        </label>
                        <label>
                            <input class="patient-input" type="checkbox" name="existing" value="Former smoker"></input>
                            Former smoker
                        </label>
                        Other: <input id="other-condition" class="patient-input" type="text" placeholder="..."></input>
                    </td>
                </tr>

                <tr>
                    <td class='patient-table-left'>In the 14 days prior to illness onset, did you have any of the
                        following
                        exposures (check all that apply)?</td>
                    <td>
                        <label>
                            <input class="patient-input" type="checkbox" name="exposures"
                                value="Travel to Wuhan"></input>
                            Travel to Wuhan
                        </label>
                        <label>
                            <input class="patient-input" type="checkbox" name="exposures"
                                value="Travel to Hubei"></input>
                            Travel to Hubei
                        </label>
                        <label>
                            <input class="patient-input" type="checkbox" name="exposures"
                                value="Travel to mainland China"></input> Travel to
                            mainland China
                        </label>
                        <label>
                            <input class="patient-input" type="checkbox" name="exposures"
                                value="Community contact with another lab-confirmed COVID-19 case-patient"></input>
                            Community contact with another
                            lab-confirmed COVID-19 case-patient
                        </label>
                        <label>
                            <input class="patient-input" type="checkbox" name="exposures"
                                value="Exposure to an infected animal"></input>
                            Exposure to an infected animal
                        </label>
                        <label>
                            <input class="patient-input" type="checkbox" name="exposures"
                                value="Exposure to a cluster of patients with severe acute lower respiratory distress of unknown etiology"></input>
                            Exposure to a
                            cluster of patients
                            with severe acute lower respiratory distress of unknown etiology
                        </label>
                        <label>
                            <input class="patient-input" type="checkbox" name="exposures"
                                value="Any healthcare contact with another lab-confirmed COVID-19 case-patient (Patient)"></input>
                            Any healthcare contact with another lab-confirmed COVID-19 case-patient (Patient)
                        </label>
                        <label>
                            <input class="patient-input" type="checkbox" name="exposures"
                                value="Any healthcare contact with another lab-confirmed COVID-19 case-patient (Visitor)"></input>
                            Any healthcare contact with another lab-confirmed COVID-19 case-patient (Visitor)
                        </label>
                        <label>
                            <input class="patient-input" type="checkbox" name="exposures"
                                value="Any healthcare contact with another lab-confirmed COVID-19 case-patient (HCW)"></input>
                            Any healthcare contact with another lab-confirmed COVID-19 case-patient (HCW)
                        </label>
                        <label>
                            <input class="patient-input" type="checkbox" name="exposures"
                                value="Household contact with another lab-confirmed COVID-19 case patient"></input>
                            Household contact with another lab-confirmed COVID-19 case patient
                        </label>
                        <label>
                            <input class="patient-input" type="checkbox" name="exposures" value="Unknown"></input>
                            Unknown
                        </label>
                        Other: <input id="other-exposure" class="patient-input" type="text" placeholder="..."></input>
                    </td>
                </tr>

                <tr>
                    <td class='patient-table-left'>Please list the street addresses of any public places (and the dates
                        you were there) that you have been in over the past 14 days.</td>
                    <td>
                        <input id="date1" class="patient-input" type="date" placeholder="03/20/2020"
                            pattern="[0-9]{2}/[0-9]{2}/[0-9]{4}" required></input>
                        <input id="location1" class="patient-input-address" type="text"
                            placeholder="813 Howard Street, Oswego, NY 13126"></input>
                        <input id="date2" class="patient-input" type="date" placeholder="03/20/2020"
                            pattern="[0-9]{2}/[0-9]{2}/[0-9]{4}" required></input>
                        <input id="location2" class="patient-input-address" type="text"
                            placeholder="813 Howard Street, Oswego, NY 13126"></input>
                        <input id="date3" class="patient-input" type="date" placeholder="03/20/2020"
                            pattern="[0-9]{2}/[0-9]{2}/[0-9]{4}" required></input>
                        <input id="location3" class="patient-input-address" type="text"
                            placeholder="813 Howard Street, Oswego, NY 13126"></input>
                        <input id="date4" class="patient-input" type="date" placeholder="03/20/2020"
                            pattern="[0-9]{2}/[0-9]{2}/[0-9]{4}" required></input>
                        <input id="location4" class="patient-input-address" type="text"
                            placeholder="813 Howard Street, Oswego, NY 13126"></input>
                        <input id="date5" class="patient-input" type="date" placeholder="03/20/2020"
                            pattern="[0-9]{2}/[0-9]{2}/[0-9]{4}" required></input>
                        <input id="location5" class="patient-input-address" type="text"
                            placeholder="813 Howard Street, Oswego, NY 13126"></input>
                        <input id="date6" class="patient-input" type="date" placeholder="03/20/2020"
                            pattern="[0-9]{2}/[0-9]{2}/[0-9]{4}" required></input>
                        <input id="location6" class="patient-input-address" type="text"
                            placeholder="813 Howard Street, Oswego, NY 13126"></input>
                        <input id="date7" class="patient-input" type="date" placeholder="03/20/2020"
                            pattern="[0-9]{2}/[0-9]{2}/[0-9]{4}" required></input>
                        <input id="location7" class="patient-input-address" type="text"
                            placeholder="813 Howard Street, Oswego, NY 13126"></input>
                        <input id="date8" class="patient-input" type="date" placeholder="03/20/2020"
                            pattern="[0-9]{2}/[0-9]{2}/[0-9]{4}" required></input>
                        <input id="location8" class="patient-input-address" type="text"
                            placeholder="813 Howard Street, Oswego, NY 13126"></input>
                        <input id="date9" class="patient-input" type="date" placeholder="03/20/2020"
                            pattern="[0-9]{2}/[0-9]{2}/[0-9]{4}" required></input>
                        <input id="location9" class="patient-input-address" type="text"
                            placeholder="813 Howard Street, Oswego, NY 13126"></input>
                        <input id="date10" class="patient-input" type="date" placeholder="03/20/2020"
                            pattern="[0-9]{2}/[0-9]{2}/[0-9]{4}" required></input>
                        <input id="location10" class="patient-input-address" type="text"
                            placeholder="813 Howard Street, Oswego, NY 13126"></input>
                    </td>
                </tr>
            </table>

            <center>
                <button class="patient-button" onclick="updateInfo()">Update information</button><br>
            </center>
        </div>
        <div id="appointments-box">
            <h1 class="portal-header">Appointments</h1>
            <table id="appointments-table">
                <tr>
                    <th>Date</th>
                    <th>Time</th>
                    <th>Testing Center</th>
                </tr>
            </table>
        </div>
        <div id="results-box">
            <h1 class="portal-header">Test results</h1>
            <table id="results-table">
                <tr>
                    <th>Date</th>
                    <th>Testing Center</th>
                    <th>Result</th>
                </tr>
            </table>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/7.13.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.13.1/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.13.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.13.1/firebase-firestore.js"></script>

    <script>
        let didApptLoad = false;
        let didResLoad = false;

        var firebaseConfig = {
            apiKey: "AIzaSyDD7IM5QAOF5y8PCHcmYg7d5ALAOAgcF2g",
            authDomain: "covid-19-challenge-63dc9.firebaseapp.com",
            databaseURL: "https://covid-19-challenge-63dc9.firebaseio.com",
            projectId: "covid-19-challenge-63dc9",
            storageBucket: "covid-19-challenge-63dc9.appspot.com",
            messagingSenderId: "16503968884",
            appId: "1:16503968884:web:0913620e1a13ecddecad21",
            measurementId: "G-X6ZB7JV3ZG"
        };
        firebase.initializeApp(firebaseConfig);
        firebase.analytics();

        let db = firebase.firestore();


        let myEditLink = document.getElementById("editLink");

        myEditLink.onclick = function () {
            editInfo();
            return false;
        };

        let myApptLink = document.getElementById("apptLink");

        myApptLink.onclick = function () {
            checkAppt();
            return false;
        };

        let myResLink = document.getElementById("resLink");

        myResLink.onclick = function () {
            viewResults();
            return false;
        };

        function editInfo() {
            db.collection("users").get().then(function (querySnapshot) {
                querySnapshot.forEach(function (doc) {
                    if (doc.id === Cookies.get("docId")) {
                        document.getElementById("firstName").value = doc.data().firstName;
                        document.getElementById("lastName").value = doc.data().lastName;
                        document.getElementById("emailAddress").value = doc.data().emailAddress;
                        document.getElementById("dateOfBirth").value = doc.data().dateOfBirth;
                        document.getElementById("homeAddress1").value = doc.data().homeAddress.split(',')[0];
                        document.getElementById("homeAddress2").value = doc.data().homeAddress.split(',')[1].substring(1) + ',' + doc.data().homeAddress.split(',')[2];
                        document.getElementById("phoneNumber").value = doc.data().phoneNumber;
                        document.getElementById("onsetDate").value = doc.data().onsetDate;
                        document.getElementById("resolutionDate").value = doc.data().resolutionDate;


                        checkAge(doc.data().dateOfBirth);

                        if ($('.parent-info').css('display') == 'table-row') {
                            document.getElementById("guardianFirstName").value = doc.data().guardianFirstName;
                            document.getElementById("guardianLastName").value = doc.data().guardianLastName;
                            document.getElementById("guardianPhoneNumber").value = doc.data().guardianPhoneNumber;
                            document.getElementById("guardianAddressLine1").value = doc.data().guardianAddress.split(',')[0];
                            document.getElementById("guardianAddressLine2").value = doc.data().guardianAddress.split(',')[1].substring(1) + ',' + doc.data().guardianAddress.split(',')[2];
                            document.getElementById("guardianEmailAddress").value = doc.data().guardianEmailAddress;
                        }

                        $("input[name=sex][value=" + doc.data().sex + "]").prop('checked', true);
                        $("input[name=ethnicity][value='" + doc.data().ethnicity + "']").prop('checked', true);
                        $("input[name=worker][value='" + doc.data().healthcareWorker + "']").prop('checked', true);
                        $("input[name=china][value='" + doc.data().healthcareChina + "']").prop('checked', true);

                        let raceAry = [];
                        raceAry = doc.data().race.split(/\,\s?(?![^\{]*\})/);

                        for (let i = 0; i < raceAry.length; i++) {
                            if (raceAry[i].includes('{') != true) {
                                $("input[name=race][value='" + raceAry[i] + "']").prop('checked', true);
                            } else {
                                text = raceAry[i].substring(1);
                                text = text.substring(0, text.length - 1);
                                document.getElementById('other-race').value = text;
                            }
                        }

                        let symptomsAry = [];
                        symptomsAry = doc.data().symptoms.split(/\,\s?(?![^\{]*\})/);

                        for (let i = 0; i < symptomsAry.length; i++) {
                            if (symptomsAry[i].includes('{') != true) {
                                $("input[name=symptoms][value='" + symptomsAry[i] + "']").prop('checked', true);
                            } else {
                                text = symptomsAry[i].substring(1);
                                text = text.substring(0, text.length - 1);
                                document.getElementById('other-symptom').value = text;
                            }
                        }

                        let existingConditionsAry = [];
                        existingConditionsAry = doc.data().existingConditions.split(/\,\s?(?![^\{]*\})/);

                        for (let i = 0; i < existingConditionsAry.length; i++) {
                            if (existingConditionsAry[i].includes('{') != true) {
                                $("input[name=existing][value='" + existingConditionsAry[i] + "']").prop('checked', true);
                            } else if (existingConditionsAry[i].includes('{Neurologic, neurodevelopmental, and/or intellectual disability') == true) {
                                $("input[name=existing][value='Neurologic, neurodevelopmental, and/or intellectual disability']").prop('checked', true);
                                let otherString = existingConditionsAry[i].split('(')[1];
                                otherString = otherString.substring(0, otherString.length - 2);
                                document.getElementById('other-disability').value = otherString;
                            } else if (existingConditionsAry[i].includes('{Other chronic diseases') == true) {
                                $("input[name=existing][value='Other chronic diseases']").prop('checked', true);
                                let otherString = existingConditionsAry[i].split('(')[1];
                                otherString = otherString.substring(0, otherString.length - 2);
                                document.getElementById('other-chronic').value = otherString;
                            } else {
                                text = existingConditionsAry[i].substring(1);
                                text = text.substring(0, text.length - 1);
                                document.getElementById('other-condition').value = text;
                            }
                        }


                        let exposuresAry = [];
                        exposuresAry = doc.data().exposures.split(/\,\s?(?![^\{]*\})/);

                        for (let i = 0; i < exposuresAry.length; i++) {
                            if (exposuresAry[i].includes('{') != true) {
                                $("input[name=exposures][value='" + exposuresAry[i] + "']").prop('checked', true);
                            } else {
                                text = exposuresAry[i].substring(1);
                                text = text.substring(0, text.length - 1);
                                document.getElementById('other-exposure').value = text;
                            }
                        }

                        let contactsAry = [];
                        contactsAry = doc.data().contacts.split(', ');

                        for (let i = 1; i < contactsAry.length + 1; i++) {
                            let dateId = "date" + i;
                            let locationId = "location" + i;
                            document.getElementById(dateId).value = contactsAry[i - 1].substring(contactsAry[i - 1].length - 11, contactsAry[i - 1].length - 1);
                            document.getElementById(locationId).value = contactsAry[i - 1].substring(0, contactsAry[i - 1].length - 13);
                        }
                    }
                })
            });

            $('#personal-information-box').css('display', 'block');
            $('#appointments-box').css('display', 'none');
            $('#results-box').css('display', 'none');
        }

        function checkAppt() {
            if (didApptLoad == false) {
                db.collection("users").get().then(function (querySnapshot) {
                    querySnapshot.forEach(function (doc) {
                        if (doc.id === Cookies.get("docId")) {
                            let apptAry = doc.data().appointments.split(/\,\s?(?![^\{]*\})/);
                            let table = document.getElementById('appointments-table');

                            for (let i = 0; i < apptAry.length; i++) {
                                let smallAry = apptAry[i].split(',');
                                var row = table.insertRow(i + 1);
                                var cell = row.insertCell(0);
                                cell.innerHTML = smallAry[0].substring(1);

                                cell = row.insertCell(1);
                                cell.innerHTML = smallAry[1];

                                cell = row.insertCell(2);
                                cell.innerHTML = smallAry[2].substring(0, smallAry[2].length - 1);
                            }
                        }
                    })
                });
                didApptLoad = true;
            }

            $('#personal-information-box').css('display', 'none');
            $('#appointments-box').css('display', 'block');
            $('#results-box').css('display', 'none');
        }

        function viewResults() {
            if (didResLoad == false) {
                db.collection("users").get().then(function (querySnapshot) {
                    querySnapshot.forEach(function (doc) {
                        if (doc.id === Cookies.get("docId")) {
                            let resAry = doc.data().results.split(/\,\s?(?![^\{]*\})/);
                            let table = document.getElementById('results-table');

                            for (let i = 0; i < resAry.length; i++) {
                                let smallAry = resAry[i].split(',');
                                var row = table.insertRow(i + 1);
                                var cell = row.insertCell(0);
                                cell.innerHTML = smallAry[0].substring(1);

                                cell = row.insertCell(1);
                                cell.innerHTML = smallAry[1];

                                cell = row.insertCell(2);
                                cell.innerHTML = '<b>' + smallAry[2].substring(0, smallAry[2].length - 1) + '</b>';
                            }
                        }
                    })
                });
                didResLoad = true;
            }

            $('#personal-information-box').css('display', 'none');
            $('#appointments-box').css('display', 'none');
            $('#results-box').css('display', 'block');
        }

        function updateInfo() {
            let firstName = $("#firstName").val();
            let lastName = $("#lastName").val();
            let emailAddress = $("#emailAddress").val();
            let dateOfBirth = $("#dateOfBirth").val();
            let phoneNumber = $("#phoneNumber").val();
            let homeAddress = $("#homeAddress1").val() + ", " + $("#homeAddress2").val();
            let sex = $("input[name='sex']:checked").val();
            let ethnicity = $("input[name='ethnicity']:checked").val();
            let race = [];

            $.each($("input[name='race']:checked"), function () {
                race.push($(this).val());
            });

            if ($("#other-race").val() !== '') {
                let string = '{' + $("#other-race").val() + '}';
                race.push(string);
            }

            race = race.join(", ");

            let healthcareWorker = $("input[name='worker']:checked").val();
            let healthcareChina = $("input[name='china']:checked").val();
            let onsetDate = $("#onsetDate").val();
            let resolutionDate = $("#resolutionDate").val();
            let symptoms = [];

            $.each($("input[name='symptoms']:checked"), function () {
                symptoms.push($(this).val());
            });

            if ($("#other-symptom").val() !== '') {
                let string = '{' + $("#other-symptom").val() + '}';
                symptoms.push(string);
            }

            symptoms = symptoms.join(", ");

            let existingConditions = [];

            $.each($("input[name='existing']:checked"), function () {
                if ($(this).val() == "Neurologic, neurodevelopmental, and/or intellectual disability") {
                    let string = '{' + $(this).val() + " (" + $("#other-disability").val() + ")" + "}";
                    existingConditions.push(string);
                } else if ($(this).val() == "Other chronic diseases") {
                    let string = '{' + $(this).val() + " (" + $("#other-chronic").val() + ")" + "}";
                    existingConditions.push(string);
                } else {
                    existingConditions.push($(this).val());
                }
            });

            if ($("#other-condition").val() !== '') {
                let string = '{' + $("#other-condition").val() + '}';
                existingConditions.push(string);
            }

            existingConditions = existingConditions.join(", ");

            let exposures = [];

            $.each($("input[name='exposures']:checked"), function () {
                exposures.push($(this).val());
            });

            if ($("#other-exposure").val() !== '') {
                let string = '{' + $("#other-exposure").val() + '}';
                exposures.push(string);
            }

            exposures = exposures.join(", ");

            let contacts = [
                $("#location1").val() + " (" + $("#date1").val() + ")",
                $("#location2").val() + " (" + $("#date2").val() + ")",
                $("#location3").val() + " (" + $("#date3").val() + ")",
                $("#location4").val() + " (" + $("#date4").val() + ")",
                $("#location5").val() + " (" + $("#date5").val() + ")",
                $("#location6").val() + " (" + $("#date6").val() + ")",
                $("#location7").val() + " (" + $("#date7").val() + ")",
                $("#location8").val() + " (" + $("#date8").val() + ")",
                $("#location9").val() + " (" + $("#date9").val() + ")",
                $("#location10").val() + " (" + $("#date10").val() + ")"
            ];

            contacts = contacts.join(", ");
            contacts = contacts.replace(/\,\s\s\(\)/gi, "");

            let password = $("#auto-password").text();

            let guardianFirstName = $("#guardianFirstName").val();
            let guardianLastName = $("#guardianLastName").val();
            let guardianPhoneNumber = $("#guardianPhoneNumber").val();
            let guardianEmailAddress = $("#guardianEmailAddress").val();
            let guardianAddress = $("#guardianAddressLine1").val() + ", " + $("#guardianAddressLine2").val();

            if ($('.parent-info').css('display') == 'table-row') {
                db.collection("users").get().then(function (querySnapshot) {
                    var i = 1;
                    querySnapshot.forEach(function (doc) {
                        if (doc.id === Cookies.get("docId")) {
                            db.collection("users").doc(doc.id).update({
                                patientType: 'Child',
                                firstName: firstName,
                                lastName: lastName,
                                emailAddress: emailAddress,
                                dateOfBirth: dateOfBirth,
                                phoneNumber: phoneNumber,
                                homeAddress: homeAddress,
                                sex: sex,
                                ethnicity: ethnicity,
                                race: race,
                                healthcareWorker: healthcareWorker,
                                healthcareChina: healthcareChina,
                                onsetDate: onsetDate,
                                resolutionDate: resolutionDate,
                                symptoms: symptoms,
                                existingConditions: existingConditions,
                                exposures: exposures,
                                contacts: contacts,
                                guardianFirstName: guardianFirstName,
                                guardianLastName: guardianLastName,
                                guardianPhoneNumber: guardianPhoneNumber,
                                guardianEmailAddress: guardianEmailAddress,
                                guardianAddress: guardianAddress
                            })
                        }
                    })
                });
            } else {
                db.collection("users").get().then(function (querySnapshot) {
                    var i = 1;
                    querySnapshot.forEach(function (doc) {
                        if (doc.id === Cookies.get("docId")) {
                            db.collection("users").doc(doc.id).update({
                                patientType: 'Adult',
                                firstName: firstName,
                                lastName: lastName,
                                emailAddress: emailAddress,
                                dateOfBirth: dateOfBirth,
                                phoneNumber: phoneNumber,
                                homeAddress: homeAddress,
                                sex: sex,
                                ethnicity: ethnicity,
                                race: race,
                                healthcareWorker: healthcareWorker,
                                healthcareChina: healthcareChina,
                                onsetDate: onsetDate,
                                resolutionDate: resolutionDate,
                                symptoms: symptoms,
                                existingConditions: existingConditions,
                                exposures: exposures,
                                contacts: contacts
                            })
                        }
                    })
                });
            }

            alert('Your information has been updated!');
        }


        function checkAge(dateOfBirth) {
            let age = new Date(dateOfBirth);
            let diff_ms = Date.now() - age.getTime();
            let age_dt = new Date(diff_ms);

            if (Math.abs(age_dt.getUTCFullYear() - 1970) < 18) {
                $('.parent-info').css('display', 'table-row');
            }
        }

        let click = 0;

        $("#information-expand").on('click', function (event) {
            event.preventDefault();
            if (click % 2 == 0) {
                var x = document.getElementsByClassName("information-paragraph");
                for (let i = 0; i < x.length; i++) {
                    x[i].style.display = 'block';
                    if (i == x.length - 1) {
                        x[i].style.paddingBottom = '20px';
                    }
                }

                x = document.getElementsByClassName("information-bullets");
                for (let i = 0; i < x.length; i++) {
                    x[i].style.display = 'block';
                }

                x = document.getElementsByClassName('information-box');
                x[0].style.height = 'auto !important';

                x = document.getElementsByClassName("information-link");
                for (let i = 0; i < x.length; i++) {
                    x[i].style.display = 'inline-flex';
                }
                document.getElementById("information-expand").innerHTML = 'Click to minimize';

                click += 1;
            } else {
                var x = document.getElementsByClassName("information-paragraph");
                for (let i = 0; i < x.length; i++) {
                    x[i].style.display = 'none';
                    if (i == x.length - 1) {
                        x[i].style.paddingBottom = '0px';
                    }
                }

                var x = document.getElementsByClassName("information-bullets");
                for (let i = 0; i < x.length; i++) {
                    x[i].style.display = 'none';
                }

                x = document.getElementsByClassName('information-box');
                x[0].style.height = 'auto !important';

                x = document.getElementsByClassName("information-link");
                for (let i = 0; i < x.length; i++) {
                    x[i].style.display = 'none';
                }
                document.getElementById("information-expand").innerHTML = 'Click to expand';
                click += 1;
            }
        });
    </script>
</body>

</html>